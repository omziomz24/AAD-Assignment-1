---
title: "AAD Assignment 1 - Group 26"
author: "Omar, Eloise, Alina, Sue"
date: "`r Sys.Date()`"
output: pdf_document
---
Testing again
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#2.1 Descriptive analysis of the data set

```{r }
data <- read.csv("Assignt1_data.csv")

# Summary stuff
str(data) 
summary(data)
head(data)
dim(data) 
data$oceanProximity <- as.factor(data$oceanProximity)

# NA's
incomplete_rows <- data[!complete.cases(data), ] # these are all missing aveBedrooms.
data <- na.omit(data)
rownames(data) <- 1:nrow(data) # need to do this otherwise can't remove outliers



#censoring
data[order(-data$medianHouseValue), ]
value <- 500001  # change to your target value
percentage <- mean(data$medianHouseValue == value) * 100
cat("Percentage of data with medianHouseValue =", value, "is", percentage, "%\n")


# initial plots
target_col <- "medianHouseValue"
exclude <- c("id","oceanProximity",target_col)

for (col in names(data)) {
  if (!(col %in% exclude)) {
    plot(data[[col]], data[[target_col]],
         xlab = col,
         ylab = target_col,
         main = paste(col, "vs", target_col))
  }
}
# For qualitative variable
boxplot(medianHouseValue ~ oceanProximity, data = data,
        main = "Median House Value by Ocean Proximity",
        xlab = "Ocean Proximity",
        ylab = "Median House Value",
        col = "lightblue")

# Need to include more stuff, very basic here

```

Single linear regression

```{r }
#Do each linear regression separately and view plots
#longitude, clearly non-linear poly?
lm.fit <- lm(medianHouseValue~longitude,data = data) 
summary(lm.fit)
plot(lm.fit)

# latitude, again non-linear poly?
lm.fit <- lm(medianHouseValue~latitude,data = data) 
summary(lm.fit)
plot(lm.fit)

#housing median age - good fit for first graph
lm.fit <- lm(medianHouseValue~housingMedianAge,data = data) 
summary(lm.fit)
plot(lm.fit)

#aveRooms, definitely non-linear, big issue with high leverage points
lm.fit <- lm(medianHouseValue~aveRooms,data = data) 
summary(lm.fit)
plot(lm.fit)


#aveBedrooms, issue with high leverage points
lm.fit <- lm(medianHouseValue~aveBedrooms,data = data) 
summary(lm.fit)
plot(lm.fit)

#population, issues with leverage, heterscedascity
lm.fit <- lm(medianHouseValue~population,data = data) 
summary(lm.fit)
plot(lm.fit)

#medianIncome non-linear and heterscedascity, some influential points too
lm.fit <- lm(medianHouseValue~medianIncome,data = data) 
summary(lm.fit)
plot(lm.fit)

#oceanProximity catergorical and need to play around with this a bit
lm.fit <- lm(medianHouseValue~oceanProximity,data = data) 
summary(lm.fit)
plot(lm.fit)


#playing around a bit
#medianIncome non-linear and heterscedascity, some influential points too
#better
lm.fit <- lm(medianHouseValue~log(medianIncome),data = data) 
summary(lm.fit)
plot(lm.fit)

#poly 2 looks pretty good, better than log
lm.fit <- lm(medianHouseValue~poly(medianIncome,2),data = data) 
summary(lm.fit)
plot(lm.fit)


#looks way better
#population, issues with leverage, heterscedascity
lm.fit <- lm(medianHouseValue~log(population),data = data) 
summary(lm.fit)
plot(lm.fit)


lm.fit <- lm(medianHouseValue~bedroomsPerRoom,data = data) 
summary(lm.fit)
plot(lm.fit)

```




2.2 Multiple linear regression

```{r }
# initial model

lm.fit <- lm(medianHouseValue~.-id-bedroomsPerRoom,data = data) # ID not a relevant predictor
summary(lm.fit)
# population (population in particular) and island and near bay look iffy
deviance(lm.fit)
contrasts(data$oceanProximity)


plot(lm.fit)
# some outliers/leverage points
# clear heteroscedasticity


# Checking Collinearity
library(car)
vif(lm.fit)

# Correlation matrix
numeric_vars <- data[sapply(data, is.numeric)]
cor_matrix <- cor(numeric_vars, use = "complete.obs")
round(cor_matrix, 2)

#Long and lat highly correlated, so are ave rooms and ave bedrooms
# can create a bedrooms to rooms ratio and include that. Or just exclude one
# also test exclude the houses with like 40 rooms, could be leverage point
# or can do interaction term?? This might be simpler. See which one is better after testing

library(leaps)

regfit.full=regsubsets(medianHouseValue~.-id,data = data,nvmax =12)
summary(regfit.full)

# Bedrooms better than rooms, could remove rooms, or do an bedrooms/rooms
# longitude and latitude equal and important, could do PCA or just do interaction term
# population unimportant


# New fit
data$bedroomsPerRoom <- data$aveBedrooms / data$aveRooms
#Removing some of these
#data$oceanProximity <- factor(data$oceanProximity, levels = setdiff(levels(data$oceanProximity), c("NEAR BAY", "ISLAND","NEAR OCEAN")))
# need to do this in PCR or ridge regression


lm.fit <- lm(medianHouseValue~poly(medianIncome,3)+longitude+latitude+longitude:latitude +bedroomsPerRoom +oceanProximity +housingMedianAge,data = data) # change between data and data_unlev
summary(lm.fit)
plot(lm.fit)
deviance(lm.fit)

# Threshold for outliers
threshold <- 2 * (length(coef(lm.fit)) + 1) / nrow(data)

# Remove outliers
data_unlev <- data[-c(5278),]


regfit.full=regsubsets(medianHouseValue~poly(medianIncome,3)+longitude+latitude+longitude:latitude+bedroomsPerRoom +oceanProximity +housingMedianAge,data = data)
summary(regfit.full)


# bedroomsPerRoom is good, still iffy with long and lat. Need to do something else
# play around more, also can do ridge, lasso and pcr maybe? - for oceanProximity to remove the irrelevant ones
```


#For plots
```{r, echo=FALSE}

```




